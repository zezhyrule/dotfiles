$(function(){function n(e){var n=t+$(e).parent("ul").find("a.js-open-close-tweet").attr("href"),r=$(e).parents("div.tweet"),i=r.attr("data-screen-name"),s=r.find("p.js-tweet-text").html().replace(/\n/g," "),o=r.find("p.js-tweet-text").find("a").not(".twitter-atreply").not(".twitter-hashtag"),u={id:"twitter",action:"addURL",url:o[0].href,title:i+": "+s,ref_id:$(e).find("a").attr("data-tweet-id")};return sendMessage(u,function(e){window.thePKT_BM.handleMessageResponse(e)}),!1}function r(e){$(e).click(function(e){e.preventDefault(),e.stopPropagation(),n(this)})}function i(e,t,n){var i=$('<li class="action-pocket-container"><a href="#" class="pocket-action" data-tweet-id="'+e+'" title="Pocket"><span><i></i><b>Pocket</b></span></a></li>');return r(i),i}function s(){var t=e.pocketButtons.length;for(var n=0;n<t;n++){var r=e.pocketButtons[n];$(r.container).each(function(){var e=$(this);if($(e).hasClass("pocket-inserted"))return;$(e).addClass("pocket-inserted");var t=$(e).parents("div.tweet").find("p.js-tweet-text").find("a").not(".twitter-atreply").not(".twitter-hashtag");if(t.length>0){var n=$(e).parents(".tweet").attr("data-item-id"),s=i(n,r.name,r.className);$(r.after).each(function(t,n){var r=$(e).find(n);if(r.length>0)return r.after(s),!1}),s.find("i").css("background-color",s.find("b").css("color"))}})}}function u(){o||(o=setInterval(function(){s()},1500))}if(isSafari()&&window.top!=window)return;var e={pocketButtons:[{name:"pocket-action",text:"Pocket",container:".stream div.stream-item-footer .tweet-actions, .permalink .simple-tweet div.stream-item-footer .tweet-actions:not(:has(a.pocket-action))",after:[".buffer-action",".action-fav-container"],className:"pocket-action",selector:".pocket-action"},{name:"pocket-permalink",text:"Pocket",container:".permalink-tweet div.stream-item-footer .tweet-actions",after:[".buffer-action",".action-fav-container"],className:"pocket-action",selector:".pocket-action"}]},t="http://twitter.com",o;addMessageListener(function(e,t,n){if(e.action==="settingChanged"&&e.key==="twitter")if(e.value==="true"||e.value===!0)u();else if(e.value==="false"||e.value===!1)clearInterval(o),o=undefined}),sendMessage({action:"getSetting",key:"twitter"},function(e){(e.value==="true"||e.value===!0)&&u()})});